<!DOCTYPE html>
<html lang="en" style="height:100%;">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>View Post - Plant Talk</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../frontend/css/pages/main.css">
    <link rel="stylesheet" href="../frontend/css/pages/shared.css">
    <link rel="stylesheet" href="../frontend/css/pages/post.css">
</head>

<body class="d-flex flex-column" style="min-height:100vh;">

    <!-- Shared Header -->
    <div id="shared-header"></div>

    <!-- Main Content -->
    <main class="container flex-grow-1 py-4">
        <!-- Loading State -->
        <div id="loading" class="text-center py-5">
            <div class="spinner-border loading-spinner" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2 text-white">Loading post...</p>
        </div>

        <!-- Error State -->
        <div id="error-container" class="d-none">
            <div class="error-message text-center">
                <h4>Post Not Found</h4>
                <p>The post you're looking for doesn't exist or has been removed.</p>
                <a href="/" class="btn btn-outline-light">Back to Home</a>
            </div>
        </div>

        <!-- Post Content -->
        <div id="post-container" class="d-none">
            <div class="row">
                <!-- Main Post Content -->
                    <div class="post-content p-4">
                        <!-- Post Header -->
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div>
                                <h1 id="post-title" class="h3 text-white mb-2"></h1>
                                <div class="author-info">
                                    <span>by <strong id="post-author"></strong></span>
                                    <span class="ms-2" id="post-time"></span>
                                </div>
                                <div id="post-tags" class="mt-2"></div>
                            </div>

                        </div>

                        <!-- Post Image -->
                        <div id="post-image-container" class="mb-3 d-none">
                            <div class="text-center">
                                <img id="post-image" class="post-image" alt="Post image" onclick="showImageModal(this.src)"
                                    style="cursor: pointer;">
                            </div>
                        </div>

                        <!-- Post Content -->
                        <div id="post-content" class="text-white mb-3"></div>

                        <!-- Post Actions -->
                        <div class="d-flex justify-content-between align-items-center border-top pt-3">
                            <div class="d-flex align-items-center gap-3">
                                <button id="share-btn" class="btn btn-outline-light btn-sm">
                                    <i class="bi bi-share"></i> Share
                                </button>
                                <span class="text-muted">
                                    <i class="bi bi-chat"></i> <span id="comment-count">0</span> comments
                                </span>
                                    <button id="like-btn" class="vote-btn" onclick="votePost(1)">
                                        <i class="bi bi-hand-thumbs-up"></i>
                                    </button>
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <span class="text-white"></span>
                                        <span id="like-count" class="fw-bold text-white fs-5">0</span>
                                    </div>
                                    <button id="dislike-btn" class="vote-btn" onclick="votePost(-1)">
                                        <i class="bi bi-hand-thumbs-down"></i>
                                    </button>
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <span class="text-white"></span>
                                        <span id="dislike-count" class="fw-bold text-white fs-5">0</span>
                                    </div>
                                    
                            </div>
                            <a href="/" class="btn btn-outline-light btn-sm">
                                <i class="bi bi-arrow-left"></i> Back to Posts
                            </a>
                        </div>
                    </div>
                </div>


            <!-- Comments Section -->
            <div class="comment-section p-4 mt-4">
                <h4 class="text-white mb-3">
                    <i class="bi bi-chat-left-text"></i> Comments
                </h4>

                <!-- Comment Form (Only for logged-in users) -->
                <div id="comment-form-container" class="d-none">
                    <div class="comment-form">
                        <form id="comment-form">
                            <div class="mb-3">
                                <label for="comment-text" class="form-label text-white">Add a comment</label>
                                <textarea id="comment-text" class="form-control" rows="3"
                                    placeholder="Share your thoughts..." required></textarea>
                            </div>
                            <div class="d-flex justify-content-between">
                                <small class="text-muted">Be respectful and constructive in your comments.</small>
                                <button type="submit" class="btn btn-outline-light">
                                    <i class="bi bi-send"></i> Post Comment
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Login Prompt for Non-logged Users -->
                <div id="login-prompt" class="text-center py-3 d-none">
                    <p class="text-muted">
                        <a href="/login" class="text-white">Login</a> or
                        <a href="/register" class="text-white">register</a> to join the discussion
                    </p>
                </div>

                <!-- Comments List -->
                <div id="comments-container">
                    <div id="comments-loading" class="text-center py-3">
                        <div class="spinner-border loading-spinner" role="status">
                            <span class="visually-hidden">Loading comments...</span>
                        </div>
                    </div>
                    <div id="comments-list"></div>
                    <div id="no-comments" class="text-center py-3 text-muted d-none">
                        <i class="bi bi-chat-square-dots fs-1"></i>
                        <p class="mt-2">No comments yet. Be the first to share your thoughts!</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Image Modal -->
    <div class="modal fade" id="imageModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Post Image</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <img id="modalImage" src="" alt="Full size image" class="img-fluid">
                </div>
            </div>
        </div>
    </div>

    <!-- Share Modal -->
    <div class="modal fade" id="shareModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Share Post</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="share-url" class="form-label">Post URL</label>
                        <div class="input-group">
                            <input type="text" id="share-url" class="form-control" readonly>
                            <button class="btn btn-outline-secondary" onclick="copyToClipboard()">
                                <i class="bi bi-clipboard"></i> Copy
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Post Edit Modal -->
    <div class="modal fade" id="editPostModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content"
                style="background-color: rgba(227, 227, 227, 0.482); backdrop-filter: blur(6px); border: 1px solid rgba(255, 255, 255, 0.2);">
                <div class="modal-header" style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                    <h5 class="modal-title text-white">Edit Post</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Categories Selection -->
                    <div class="mb-3">
                        <label class="form-label text-white">Choose Categories</label>
                        <div class="category-selection">
                            <div class="category-bubbles" id="editCategoryBubbles">
                                <!-- Categories will be loaded here -->
                                <div class="text-center w-100">
                                    <div class="spinner-border spinner-border-sm text-light" role="status">
                                        <span class="visually-hidden">Loading categories...</span>
                                    </div>
                                </div>
                            </div>
    
                            <div class="selected-categories mt-2" id="editSelectedCategories">
                                <!-- Selected categories will appear here -->
                            </div>
    
                            <div class="category-help-text mt-2"
                                style="font-size: 0.85rem; color: rgba(255, 255, 255, 0.7);">
                                <i class="bi bi-info-circle me-1"></i>
                                Click on categories to select them. You can choose multiple categories for your post.
                            </div>
                        </div>
                    </div>
    
                    <!-- Title -->
                    <div class="mb-3">
                        <label for="edit-post-title" class="form-label text-white">Title</label>
                        <input type="text" id="edit-post-title" class="form-control"
                            style="background-color: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3); color: white;">
                    </div>
    
                    <!-- Content -->
                    <div class="mb-3">
                        <label for="edit-post-content" class="form-label text-white">Content</label>
                        <textarea id="edit-post-content" class="form-control" rows="6"
                            style="background-color: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3); color: white;"></textarea>
                    </div>
                </div>
                <div class="modal-footer" style="border-top: 1px solid rgba(255, 255, 255, 0.1);">
                    <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-outline-light" id="save-post-btn" disabled>Save Changes</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Post Delete Modal -->
    <div class="modal fade" id="deletePostModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content"
                style="background-color: rgba(227, 227, 227, 0.482); backdrop-filter: blur(6px); border: 1px solid rgba(255, 255, 255, 0.2);">
                <div class="modal-header" style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                    <h5 class="modal-title text-white">Delete Post</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="text-white">Are you sure you want to delete this post? This action cannot be undone.</p>
                </div>
                <div class="modal-footer" style="border-top: 1px solid rgba(255, 255, 255, 0.1);">
                    <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-outline-danger" id="confirm-delete-post-btn">Delete Post</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Comment Edit Modal -->
    <div class="modal fade" id="editCommentModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content"
                style="background-color: rgba(227, 227, 227, 0.482); backdrop-filter: blur(6px); border: 1px solid rgba(255, 255, 255, 0.2);">
                <div class="modal-header" style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                    <h5 class="modal-title text-white">Edit Comment</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <textarea id="edit-comment-text" class="form-control" rows="4"
                        style="background-color: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3); color: white;"
                        placeholder="Edit your comment..."></textarea>
                </div>
                <div class="modal-footer" style="border-top: 1px solid rgba(255, 255, 255, 0.1);">
                    <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-outline-light" id="save-comment-btn">Save Changes</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Comment Delete Modal -->
    <div class="modal fade" id="deleteCommentModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content"
                style="background-color: rgba(227, 227, 227, 0.482); backdrop-filter: blur(6px); border: 1px solid rgba(255, 255, 255, 0.2);">
                <div class="modal-header" style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                    <h5 class="modal-title text-white">Delete Comment</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="text-white">Are you sure you want to delete this comment? This action cannot be undone.</p>
                </div>
                <div class="modal-footer" style="border-top: 1px solid rgba(255, 255, 255, 0.1);">
                    <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-outline-danger" id="confirm-delete-comment-btn">Delete
                        Comment</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Shared footer -->
    <div id="shared-footer"></div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Load shared partials -->
    <script src="/frontend/js/header-auth.js"></script>

    <script src="/frontend/js/view-post.js"></script>
</body>

</html>